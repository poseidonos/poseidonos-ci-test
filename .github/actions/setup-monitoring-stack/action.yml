name: "Setup Monitoring"
Description: "This action deploy monitoring stacks for poseidonos"
inputs:
  POS_WORKING_DIR:
    required: true
  GA_COMMIT_HASH:
    required: true
  GA_WORKFLOW:
    required: true
  GA_DETAIL:
    required: true
    
  POS_EXPORTER_PORT:
    required: true

  AMP_REMOTE_WRITE_URL:
    required: true
  AMP_SIGV4_REGION:
    required: true
  AMP_SIGV4_ACCESS_KEY:
    required: true
  AMP_SIGV4_SECRET_KEY:
    required: true
  
  LOGSTASH_PORT:									      
    required: true
  
  OS_DOMAIN_ENDPOINT:
    required: true
  OS_REGION:
    required: true
  
runs:
  using: "composite"
  steps:
    - name: "Set environment variable"
      run: |
        export PROMETHEUS_CONF_PATH=${inputs.POS_WORKING_DIR}/config/prometheus.yml
	export FILEBEAT_CONF_PATH=${inputs.POS_WORKING_DIR}/config/filebeat.yml
	export LOGSTASH_CONF_PATH=${inputs.POS_WORKING_DIR}/config/logstash.conf

    - name: "Run pos-exporter"
      run: nohup ${{inputs.POS_WORKING_DIR}}/bin/pos-exporter < /dev/null 1> ${POS_WORKING_DIR}/bin/pos-exporter_stdout.txt  2> ${POS_WORKING_DIR}/bin/pos-exporter_stderr.txt 
      shell: bash

    - name: "Deploy Prometheus"
      run:
      shell: bash

